name: Check Rebase Status
on:
  pull_request:
    branches:
      - develop
jobs:
# 1st job
 collect-info:
   runs-on: ubuntu-latest
   steps:
     - name: PR Details
       run: |
         echo "â•â•â•â•â•â•â•â•â•â•"
         echo "ğŸ”„ Pull Request Information"
         echo "â•â•â•â•â•â•â•â•â•â•"
         echo "ğŸ“ Title    : ${{ github.event.pull_request.title }}"
         echo "ğŸ”¢ Number   : #${{ github.event.pull_request.number }}"
         echo "ğŸ‘¤ Author   : ${{ github.event.pull_request.user.login }}"
         echo "â° Created  : ${{ github.event.pull_request.created_at }}"
         echo "ğŸ”€ Source   : ${{ github.head_ref }}"
         echo "ğŸ¯ Target   : ${{ github.base_ref }}"
         echo "ğŸŒ URL      : ${{ github.event.pull_request.html_url }}"
         echo "â•â•â•â•â•â•â•â•â•â•"

# 2nd job
 check-rebase:
   needs: collect-info
   runs-on: ubuntu-latest
   steps:
     - uses: actions/checkout@v4
       with:
         fetch-depth: 0
         
     - name: Branch Analysis
       run: |
         echo "â•â•â•â•â•â•â•â•â•â•"
         echo "ğŸ”„ Branch Analysis"
         echo "â•â•â•â•â•â•â•â•â•â•"
         git fetch origin
         AHEAD=$(git rev-list --count origin/${{ github.base_ref }}..HEAD)
         BEHIND=$(git rev-list --count HEAD..origin/${{ github.base_ref }})
         TOTAL_COMMITS=$(git rev-list --count HEAD)
         LAST_COMMIT=$(git log -1 --pretty=%B)
         
         echo "ğŸ“Š Status Summary"
         echo "â”œâ”€â”€ ğŸ“ˆ Total commits  : $TOTAL_COMMITS"
         echo "â”œâ”€â”€ ğŸ”¼ Ahead by      : $AHEAD commits"
         echo "â”œâ”€â”€ ğŸ”½ Behind by     : $BEHIND commits"
         echo "â””â”€â”€ ğŸ“ Last commit   : $LAST_COMMIT"
         
         if [ $BEHIND -gt 0 ]; then
           echo ""
           echo "âŒ REBASE REQUIRED"
           echo "â•â•â•â•â•â•â•â•â•â•"
           echo "ğŸ’¢ Branch is $BEHIND commits behind ${{ github.base_ref }}"
           echo ""
           echo "ğŸ’¡ To fix:"
           echo "1ï¸âƒ£ git checkout ${{ github.head_ref }}"
           echo "2ï¸âƒ£ git pull --rebase origin ${{ github.base_ref }}"
           echo "3ï¸âƒ£ git push --force-with-lease"
         echo "â•â•â•â•â•â•â•â•â•â•"
           exit 1
         else
           echo ""
           echo "âœ… BRANCH UP TO DATE ğŸ¤Œ ğŸŠ"
           echo "â•â•â•â•â•â•â•â•â•â•"
         fi
